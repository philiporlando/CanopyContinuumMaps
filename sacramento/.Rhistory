,ifelse(sample_id_adj$sample_id == "658", "719"
,ifelse(sample_id_adj$sample_id == "453", "421"
,ifelse(sample_id_adj$sample_id == "533", "502"
,sample_id_adj$sample_id)
)
)
)
)
)
)
# create a second layer of grid cells that are not adjacent (only by corners, not sides)
grid_sample2 <- grid_sp[grid_sp@data$id %in% sample_id_adj$sample_id, ]
# color code
levels <- 10
plotclr <- brewer.pal(levels, "RdYlGn")
class2 <- classIntervals(grid_sample@data$population
,n = levels
,style = "quantile"
)
colcode2 <- findColours(class2
,rev(plotclr)
)
# population density and cell id label (target cells)
labels3 <- sprintf(
"<strong>ID: %s</strong><br/> Population Density: %s km<sup>-2</sup>"
,grid_sample2@data$id
,comma(round(grid_sample2@data$population, 0)
)
) %>%
lapply(HTML)
# labels for EPA AirData sites
labels_airnow <- sprintf(
paste0("<strong>EPA AirData: </strong><br/>"
,sacra_points@data$Local.Site.Name
)
) %>%
lapply(HTML)
# labels for existing purpleair sites
labels_pa <- sprintf(
paste0("<strong>PurpleAir: </strong><br/>"
,pa_points$site_name
)
) %>%
lapply(HTML)
# create a palette for addLegend()
legendCode <- colorBin(palette = rev(plotclr)
,domain = class$brks
,bins = round(class$brks, 2)
,pretty = FALSE # this will add extra bins if set to T
)
# create a new web map with the grid_sample layer!
m2 = leaflet() %>%
addTiles(group = "OSM (default)") %>%
#addProviderTiles(providers$CartoDB.Positron) %>%
addTiles('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png'
,group = "OSM (BlackAndWhite)") %>%
# provide empty grid cells as a base layer
# addPolygons(data = grid_sp
#             ,color = "black"
#             ,fillColor = "blue"
#             ,fillOpacity = 0.00
#             ,weight = 0.5
#             ,group = "Total Grid Cells"
#             ) %>%
addPolygons(data = grid_sp
,color = "black"
,fillColor = colcode
,fillOpacity = 0.20
,weight = 0.5
#,popup = pop1
# interaction
,group = "Total Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
,dashArray = ""
,fillOpacity = 0.7
#,bringToFront = TRUE
)
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
#,label = labels2
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample2
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells Adjusted"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
,label = labels3
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
hideGroup(c("Target Grid Cells", "Target Grid Cells Adjusted")) %>%
# pull in regional monitoring sites
addCircleMarkers(data = sacra_points
,fillColor = "blue"
,color = "blue"
,weight = 1.5
,fillOpacity = 0.5
#,popup = airnow_pop
,group = "Regional Monitoring Sites"
,label = labels_airnow
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# pull in existing PurpleAir monitors
addCircleMarkers(data = pa_points
,fillColor = "purple"
,fillOpacity = 0.25 # since there are two circles per geometry... (B sensor)
,color = "purple"
,weight = 1.5
#,popup = pa_pop
,group = "Existing PurpleAir"
,label = labels_pa
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
addLayersControl(
baseGroups = c("OSM  (BlackAndWhite)"
,"OSM (default)"
)
,overlayGroups = c("Total Grid Cells"
,"Target Grid Cells"
,"Target Grid Cells Adjusted"
,"Regional Monitoring Sites"
,"Existing PurpleAir"
)
,options = layersControlOptions(collapsed = TRUE)
,position = "topright"
) %>%
# turns the unadjusted target grid cells off by default
hideGroup("Target Grid Cells") %>%
# add a scale bar
addScaleBar(position = "bottomleft") %>%
#
addLegend(pal = legendCode
,values = class$brks
,position = "bottomright"
,title = "<b>Population Density (km<sup>-2</sup>) </b>")
m2
# create a new web map with the grid_sample layer!
m2 = leaflet() %>%
addTiles(group = "OSM (default)") %>%
#addProviderTiles(providers$CartoDB.Positron) %>%
addTiles('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png'
,group = "OSM (BlackAndWhite)") %>%
# provide empty grid cells as a base layer
# addPolygons(data = grid_sp
#             ,color = "black"
#             ,fillColor = "blue"
#             ,fillOpacity = 0.00
#             ,weight = 0.5
#             ,group = "Total Grid Cells"
#             ) %>%
addPolygons(data = grid_sp
,color = "black"
,fillColor = colcode
,fillOpacity = 0.20
,weight = 0.5
#,popup = pop1
# interaction
,group = "Total Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
,dashArray = ""
,fillOpacity = 0.7
#,bringToFront = TRUE
)
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
#,label = labels2
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample2
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells Adjusted"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
,label = labels3
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
hideGroup(c("Target Grid Cells", "Target Grid Cells Adjusted")) %>%
# pull in regional monitoring sites
addCircleMarkers(data = sacra_points
,fillColor = "blue"
,color = "blue"
,weight = 1.5
,fillOpacity = 0.5
#,popup = airnow_pop
,group = "Regional Monitoring Sites"
,label = labels_airnow
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# pull in existing PurpleAir monitors
addCircleMarkers(data = pa_points
,fillColor = "purple"
,fillOpacity = 0.25 # since there are two circles per geometry... (B sensor)
,color = "purple"
,weight = 1.5
#,popup = pa_pop
,group = "Existing PurpleAir"
,label = labels_pa
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
addLayersControl(
baseGroups = c("OSM  (BlackAndWhite)"
,"OSM (default)"
)
,overlayGroups = c("Total Grid Cells"
,"Target Grid Cells"
,"Target Grid Cells Adjusted"
,"Regional Monitoring Sites"
,"Existing PurpleAir"
)
,options = layersControlOptions(collapsed = FALSE)
,position = "topright"
) %>%
# turns the unadjusted target grid cells off by default
hideGroup("Target Grid Cells") %>%
# add a scale bar
addScaleBar(position = "bottomleft") %>%
#
addLegend(pal = legendCode
,values = class$brks
,position = "bottomright"
,title = "<b>Population Density (km<sup>-2</sup>) </b>")
m2
# create a new web map with the grid_sample layer!
m2 = leaflet() %>%
addTiles(group = "OSM (default)") %>%
#addProviderTiles(providers$CartoDB.Positron) %>%
addTiles('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png'
,group = "OSM (BlackAndWhite)") %>%
# provide empty grid cells as a base layer
# addPolygons(data = grid_sp
#             ,color = "black"
#             ,fillColor = "blue"
#             ,fillOpacity = 0.00
#             ,weight = 0.5
#             ,group = "Total Grid Cells"
#             ) %>%
addPolygons(data = grid_sp
,color = "black"
,fillColor = colcode
,fillOpacity = 0.20
,weight = 0.5
#,popup = pop1
# interaction
,group = "Total Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
,dashArray = ""
,fillOpacity = 0.7
#,bringToFront = TRUE
)
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
#,label = labels2
,label = labels
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# add grid cells from our sample id list
addPolygons(data = grid_sample2
,color = "black"
,fillColor = colcode2
#,fillColor = NULL
,fillOpacity = 0.00001
,weight = 2.5
,opacity = 1
#,popup = pop1
# interaction
,group = "Target Grid Cells Adjusted"
,highlight = highlightOptions(
weight = 5
,color = "#666"
#,color = NULL
,dashArray = ""
,fillOpacity = 0.000001
#,bringToFront = TRUE
)
,label = labels3
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
,padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
hideGroup(c("Target Grid Cells", "Target Grid Cells Adjusted")) %>%
# pull in regional monitoring sites
addCircleMarkers(data = sacra_points
,fillColor = "blue"
,color = "blue"
,weight = 1.5
,fillOpacity = 0.5
#,popup = airnow_pop
,group = "Regional Monitoring Sites"
,label = labels_airnow
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
# pull in existing PurpleAir monitors
addCircleMarkers(data = pa_points
,fillColor = "purple"
,fillOpacity = 0.25 # since there are two circles per geometry... (B sensor)
,color = "purple"
,weight = 1.5
#,popup = pa_pop
,group = "Existing PurpleAir"
,label = labels_pa
,labelOptions = labelOptions(
style = list("font-weight" = "normal"
, padding = "3px 8px"
)
,textsize = "15px"
,direction = "auto"
)
) %>%
addLayersControl(
baseGroups = c("OSM  (BlackAndWhite)"
,"OSM (default)"
)
,overlayGroups = c("Total Grid Cells"
,"Target Grid Cells"
,"Target Grid Cells Adjusted"
,"Regional Monitoring Sites"
,"Existing PurpleAir"
)
,options = layersControlOptions(collapsed = TRUE)
,position = "topright"
) %>%
# turns the unadjusted target grid cells off by default
hideGroup("Target Grid Cells") %>%
# add a scale bar
addScaleBar(position = "bottomleft") %>%
#
addLegend(pal = legendCode
,values = class$brks
,position = "bottomright"
,title = "<b>Population Density (km<sup>-2</sup>) </b>")
m2
getwd()
setwd("J:/2018-04-027-SacramentoAirDataPurpleAirComparison/")
setwd("J:/2018-04-027-SacramentoAirDataPurpleAirComparison")
